# Проектирование высоконагруженного сайта объявлений

Курсовая работа в рамках 3-го семестра программы по Веб-разработке ОЦ VK x МГТУ им. Н.Э. Баумана (ex. "Технопарк") по дисциплине "Проектирование высоконагруженных сервисов"

#### Автор - [Максим Сиканов](https://park.vk.company/profile/m.sikanov/ "Страница на портале VK x МГТУ")
#### Задание - [Методические указания](https://github.com/init/highload/blob/main/homework_architecture.md)

#### Содержание:
1. [Тема, функционал и аудитория](#1)
2. [Расчёт нагрузки](#2)
3. [Глобальная балансировка нагрузки](#3)
4. [Локальная балансировка нагрузки](#4)
5. [Логическая схема базы данных](#5)
6. [Физическая схема базы данных](#6)
7. [Алгоритмы](#7)
8. [Технологии](#8)
9. [Обеспечение надёжности](#9)
10. [Схема проекта](#10)
11. [Расчёт ресурсов](#11)


## Часть 1. Тема и целевая аудитория <a name="1"></a>

### Тема курсовой работы - **"Проектирование сайта объявлений"**
В качестве примера и аналога выбран ведущий в России сайт объявлений - [Avito](https://www.avito.ru/)

### Ключевой функционал сервиса
- Регистрация и авторизация пользователей
- Создание / редактирование / поиск / просмотр объявлений
- Возможность оставлять отзывы

### Ключевые продуктовые решения
- Поиск (по фильтрам)

### Целевая аудитория
- 61 млн активных пользователей в месяц в странах СНГ [^1]
- В среднем пользователи проводят на Авито 11 минут в месяц [^1]
- 97% трафика поступает на Авито из России [^1]
- Демография: 56.79% мужчин и 43.21% женщин [^1]

![img.png](src/age.png)

## Часть 2. Расчёт нагрузки <a name="2"></a>

### Продуктовые метрики

MAU - 61 млн пользователей [^1]

DAU - 2 млн пользователей [^1]

#### Среднее количество действий пользователя по типам в день:
- В Авито создается ≈ `1.4 млн` объявлений в день [^1] => `0.0226 объявлений/сут` на человека
- В Авито происходит ≈ `8` сделок в секунду [^1] => `0.0113 сделок/сут` на человека
- посещаемость Авито более `384 млн` пользователей в месяц [^1] => `0.21 посещений/сут` на человека


### Технические метрики

#### Средний размер харанилища пользователя по типам:
| Хранимые данные                                 | Оценочный размер на пользователя |
|-------------------------------------------------|----------------------------------|
| Персональные данные (ФИО, почта, пароль и т.д.) | `1 КБ`                           |
| Аватар                                          | `256 КБ`                         |
| Объявление                                      | `1 МБ`                           |
| Отзыв                                           | `1 КБ`                           |

- Объявление в среднем содержит 3-4 фото (размер фото в среднем `256 КБ`) и текстовое описание. Итого ≈ `1 МБ`
- В среднем на одного пользователя приходится 5 объявления и 10 отзывов [^1]

Возьмём общее оценочное число пользователей с запасом = `100 млн` - будем использовать далее в расчётах.

Тогда общий размер хранилища в худшем случае: `100 млн пользователей * (5 МБ на объявления + 256 КБ на аватар + 1 КБ персональные данные + 10 КБ отзывы) ≈ 311 ТБ 180 ГБ`


#### RPS по типам запросов:
| Тип запроса               | Средний оценочный RPS |
|---------------------------|-----------------------|
| Создание объявления       | `17`                  |
| Редактирование объявления | `139`                 |
| Поиск объявлений          | `70`                  |
| Просмотр объявлений       | `7000`                |
| Создание отзыва           | `5`                   |
| Просмотр отзывов          | `210`                 |

Расчёты RPS:
- Создание объявления: `1.4 млн объявлений в сутки / (24 * 3600) ~= 17 RPS`
- Редактирование объявления: `12 млн объявлений в сутки / (24 * 3600) ~= 139 RPS` [^2]
- Поиск объявлений: `2 млн DAU * 3 / (24 * 3600) ~= 70 RPS` при условии, что каждый сделает 3 поиска
- Просмотр объявлений: `2 млн DAU * 3 * 100 / (24 * 3600)  ~= 7000 RPS` при условии, что каждый поиск будет сожержать 100 объявлений
- Создание отзыва: `10 сделок/с * 0.5 = 5 RPS` при условии, что каждый второй будет оставлять отзыв
- Просмотр отзывов: `70 поиск/с * 3 = 210 RPS` при условии, за один поиск человек откроет отзывы 3 раза

Суммарный RPS по основным запросам:  `7441` и существенным образом определяется RPS'ом к сервисам объявлений

#### Сетевой трафик

**Пиковое потребление в течение суток (Гбит/с) по типам трафика:**

| Тип трафика             | Пиковое потребление, Гбит/с | Суммарный суточный трафик, Тб/сутки |
|-------------------------|-----------------------------|-------------------------------------|
| API + Cтатические файлы | `43.8`                      | `1231.9`                            |

Расчёты трафика:

**Средний:**
- API + Статика: `7441 RPS * (256 КБ + 1.5 КБ) средний размер / (1024 * 1024) = 14.6 Гбит/с`

**Пиковый:**

Пиковый коэф трафика от среднего с запасом = 3
- API + Статика: `3 пиковый коэф * 14.6 Гбит/с средний трафик = 43.8 Гбит/с`

**Суммарный суточный:**
- API + Статика: `14.6 Гбит/с средний трафик * (24 * 3600) с/сут = 1231.9 Тб/сут`


## Часть 3. Глобальная балансировка нагрузки <a name="3"></a>


## Часть 4. Локальная балансировка нагрузки <a name="4"></a>


## Часть 5. Логическая схема базы данных <a name="5"></a>


## Часть 6. Физическая схема базы данных <a name="6"></a>


## Часть 7. Алгоримты <a name="7"></a>


## Часть 8. Технологии <a name="8"></a>


## Часть 9. Обеспечение надёжности <a name="9"></a>


## Часть 10. Схема проекта <a name="10"></a>


## Часть 11. Расчёт ресурсов <a name="11"></a>


### Список источников:
[^1]: [Статистика Авито в 2024 году](https://inclient.ru/avito-stats/#avito)

[^2]: [Авито Playbook](https://github.com/avito-tech/playbook)
